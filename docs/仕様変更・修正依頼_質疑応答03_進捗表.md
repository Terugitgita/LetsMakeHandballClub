# 仕様変更・修正依頼 質疑応答03 進捗管理表

---

## P70: 「作者に一言」機能

| 項目 | 内容 |
|------|------|
| ①タイトル | ゲーム画面右上に「作者に一言」ボタン追加 |
| ②背景 | バグ報告・フィードバック・要望を収集し、ゲーマー間で共有する機能 |
| ③要件① | 画面右上に常時表示されるボタン |
| ③要件② | バグ報告「今！」ボタン（直近5ステップのアクション履歴+状態を自動記載） |
| ③要件③ | フィードバック投稿（機能要望、仕様修正、新ゲーム案、自由投稿） |
| ③要件④ | 投稿はカード形式で表示 |
| ③要件⑤ | ユーザー識別はニックネーム入力 |
| ③要件⑥ | 投稿者本人には即時表示、他ユーザーには作者承認後 |
| ③要件⑦ | 作者が「表示」「非表示」「削除」を選択可能 |
| ③要件⑧ | オフライン時は機能無効（グレーアウト） |

---

## 決定事項

| 質問 | 回答 |
|------|------|
| Q1: バックエンド | E) GitHub活用 |
| Q2: ユーザー識別 | B) ニックネーム入力 |
| Q3: 5ステップ詳細 | B) アクション履歴+状態（試合中は詳細） |
| Q4: 表示形式 | B) カード形式 |
| Q5: 管理画面 | ローカルバッチ起動の管理GUI |
| Q6: 公開フロー | B) 本人即時表示、他ユーザーは承認後 |
| Q7: ボタン位置 | A) 右上固定 |
| Q8: オフライン | A) オフライン時は機能無効 |
| Q9: GitHub方式 | D) GitHub Gist |
| Q10: 管理構成 | A) ローカルNode.jsサーバー構成OK |
| Q11: 投稿セキュリティ | A) Google Forms 埋め込み |
| 優先順位 | B) 全機能同時実装 |

---

## アーキテクチャ

```
[ユーザー側]
ゲーム画面
├── 「作者に一言」ボタン（右上固定）
├── Google Forms 埋め込み（投稿用）
└── GitHub Gist から公開投稿を取得・表示

[データフロー]
ユーザー投稿 → Google Forms → Spreadsheet
     ↓ (作者が手動確認)
作者承認 → GitHub Gist に公開
     ↓
全ユーザーに表示

[管理者側]
admin/
├── start-admin.bat          ← ダブルクリックで起動
├── admin-server.js          ← localhost:3000
├── admin.html               ← 管理画面UI
└── admin-data/
    └── feedback.json        ← ローカルDB
```

---

## 実装タスク

### Phase 1: UI基盤

| No | タスク | ファイル | ステータス |
|----|--------|----------|-----------|
| 1-1 | 「作者に一言」ボタンUI作成 | `js/screens.js` | [x] |
| 1-2 | モーダルダイアログ作成 | `js/screens.js` | [x] |
| 1-3 | オフライン検出・グレーアウト | `js/screens.js` | [x] |
| 1-4 | CSS スタイリング | `css/style.css` | [x] |

### Phase 2: アクション履歴トラッキング

| No | タスク | ファイル | ステータス |
|----|--------|----------|-----------|
| 2-1 | actionHistory配列をgameStateに追加 | `js/gameState.js` | [x] |
| 2-2 | recordAction関数実装 | `js/gameState.js` | [x] |
| 2-3 | 画面遷移時に履歴記録 | `js/screens.js` | [x] |
| 2-4 | 練習実行時に履歴記録 | `js/training.js` | [x] |
| 2-5 | 試合イベント（開始/得点/終了）記録 | `js/match.js` | [x] |
| 2-6 | getActionHistoryText関数実装 | `js/gameState.js` | [x] |
| 2-7 | getMatchStateText関数実装 | `js/gameState.js` | [x] |
| 2-8 | 「今！」ボタンで履歴をテキスト化 | `js/screens.js` | [x] |

### Phase 3: 投稿機能（Google Forms連携）

| No | タスク | ファイル | ステータス |
|----|--------|----------|-----------|
| 3-1 | FEEDBACK_CONFIG設定追加 | `js/config.js` | [x] |
| 3-2 | ゲーム内からForm呼び出し | `js/screens.js` | [x] |
| 3-3 | 投稿カテゴリ選択UI | `js/screens.js` | [x] |
| 3-4 | submitFeedback関数実装 | `js/screens.js` | [x] |
| 3-5 | フォールバック（クリップボードコピー） | `js/screens.js` | [x] |

### Phase 4: 公開投稿表示（GitHub Gist連携）

| No | タスク | ファイル | ステータス |
|----|--------|----------|-----------|
| 4-1 | fetchPublicPosts関数実装 | `js/screens.js` | [x] |
| 4-2 | カード形式で投稿一覧表示 | `js/screens.js` | [x] |
| 4-3 | 作者返信の表示 | `js/screens.js` | [x] |
| 4-4 | サンプルデータ（Gist未設定時） | `js/screens.js` | [x] |

### Phase 5: 管理画面（ローカル）

| No | タスク | ファイル | ステータス |
|----|--------|----------|-----------|
| 5-1 | admin/ フォルダ構成作成 | `admin/` | [x] |
| 5-2 | start-admin.bat 作成 | `admin/start-admin.bat` | [x] |
| 5-3 | admin-server.js 作成 | `admin/admin-server.js` | [x] |
| 5-4 | admin.html 管理UI作成 | `admin/admin.html` | [x] |
| 5-5 | feedback.json初期化 | `admin/admin-data/feedback.json` | [x] |
| 5-6 | .gitignore にadmin/追加 | `.gitignore` | [x] |

---

## 全体進捗サマリー

| No | 項目 | 種別 | 調査 | 実装 | ユーザー確認 | 備考 |
|----|------|------|------|------|--------------|------|
| P70 | 作者に一言機能 | 新機能 | [x] | [x] | [ ] | 全フェーズ完了 |

**最終更新:** 2026-01-05

---

## 使用方法

### ユーザー向け
1. ゲーム画面右上の「💬」ボタンをクリック
2. 「バグ報告」「要望・意見」「投稿一覧」のタブを選択
3. バグ報告時は「今！」ボタンで直近の操作履歴を自動記載
4. ニックネームを入力して投稿

### 管理者向け
1. `admin/start-admin.bat` をダブルクリック
2. ブラウザで `http://localhost:3000` を開く
3. 投稿を「Approve」「Show/Hide」「Reply」「Delete」で管理
4. 「Export for Gist」でGitHub Gist更新用JSONを取得

### 設定（任意）
`js/config.js` の `FEEDBACK_CONFIG` に以下を設定:
- `GOOGLE_FORM_URL`: Google FormsのURL
- `GIST_URL`: GitHub GistのURL

未設定時はフォールバック動作（クリップボードコピー、サンプルデータ表示）

---
