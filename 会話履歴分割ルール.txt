# 会話履歴分割ルール v2.0

## 基本方針
Claudeは常に「アクティブファイル + 最新アーカイブ」の2ファイルを読み込む。
これにより、約1,800行の文脈を維持しながら効率的に履歴を管理する。

## ファイル構成

| ファイル | 目標行数 | 役割 |
|---------|---------|------|
| 会話履歴.md | ~300行 | アクティブ（最新の会話） |
| 会話履歴_archive_XX.md (最新) | ~1,500行 | Claudeが読み込む最新アーカイブ |
| 会話履歴_archive_XX.md (古い) | ~1,500行 | 参照用（通常は読み込まない） |

## 分割トリガー
アクティブファイル（会話履歴.md）が **1,500行を超えた時** に分割を実行。

## 分割手順

### ケース1: 最新アーカイブが存在しない、または1,500行に達している場合
```
アクティブ 1,700行 → 分割
  ├─ 会話履歴.md: 200行（最新部分を保持）
  └─ 会話履歴_archive_XX.md: 1,500行（新規作成）
```

### ケース2: 最新アーカイブが1,500行未満の場合
```
アクティブ 1,600行、最新アーカイブ 800行 → 分割
  ├─ 会話履歴.md: 200行（最新部分を保持）
  ├─ 最新アーカイブ: 800→1,500行（700行追加で1,500行に）
  └─ 新アーカイブ: 700行（余り）
```

## Claudeの読み込みルール

1. **必ず読み込む:**
   - 会話履歴.md（アクティブ）
   - 会話履歴_archive_XX.md（最新アーカイブ1つ）

2. **合計読み込み量:** 約1,800行（~24,000 tokens）

3. **古いアーカイブ:** 必要な場合のみ参照

## アーカイブ命名規則
- 会話履歴_archive_01.md（最古）
- 会話履歴_archive_02.md
- ...
- 会話履歴_archive_XX.md（最新）

番号が大きいほど新しい。

## トークン制限
| 項目 | 値 |
|------|-----|
| 読み込み上限 | 25,000 tokens |
| 1行あたり平均 | ~13.5 tokens |
| 安全上限 | ~1,850行 |
| 推奨合計 | ~1,800行（アクティブ300 + アーカイブ1,500）|

---
最終更新: 2025-12-20
